# åˆè¯†Umi.JS

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210126140351173.png#pic_center)

### ä»€ä¹ˆæ˜¯Umi.js?

Umiï¼Œä¸­æ–‡å¯å‘éŸ³ä¸º**ä¹Œç±³**ï¼Œæ˜¯å¯æ‰©å±•çš„ä¼ä¸šçº§å‰ç«¯åº”ç”¨æ¡†æ¶ã€‚Umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼Œä¿è¯è·¯ç”±çš„åŠŸèƒ½å®Œå¤‡ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ç„¶åé…ä»¥ç”Ÿå‘½å‘¨æœŸå®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ã€‚

### ä¸ºä»€ä¹ˆä½¿ç”¨Umi.js?

æˆ‘ä»¬åšreactå¼€å‘çš„æ—¶å€™ä¼šä¸ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼Ÿï¼š
 1.é¡¹ç›®åšå¤§çš„æ—¶å€™ï¼Œå¼€å‘è°ƒè¯•çš„å¯åŠ¨å’Œçƒ­æ›´æ–°æ—¶é—´ä¼šå˜å¾—å¾ˆé•¿ã€‚
 2.å¤§åº”ç”¨ä¸‹ï¼Œç½‘ç«™æ‰“å¼€å¾ˆæ…¢ï¼Œæœ‰æ²¡æœ‰åŠæ³•åŸºäºè·¯ç”±åšåˆ°æŒ‰éœ€åŠ è½½ã€‚
 3.dvaçš„modelæ¯æ¬¡éƒ½è¦æ‰‹å†™è½½å…¥ï¼Œèƒ½å¦ä¸€å¼€å§‹å°±åŒé¡¹ç›®åˆå§‹åŒ–å¥½ï¼Ÿ

ä½¿ç”¨ä¹Œç±³ï¼Œå³å¯è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œå¹¶ä¸”è¿˜èƒ½æä¾›å¦‚ä¸‹ä¼˜åŠ¿ï¼š

- ğŸ‰å¼€ç®±å³ç”¨ï¼Œå†…ç½® reactã€react-router ç­‰
- ğŸ“¦ç±» next.js ä¸”åŠŸèƒ½å®Œå¤‡çš„è·¯ç”±çº¦å®šï¼ŒåŒæ—¶æ”¯æŒé…ç½®çš„è·¯ç”±æ–¹å¼
- ğŸ å®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸ
- ğŸš€ ä¸€é”®å…¼å®¹åˆ° IE9
- ğŸ‰å®Œå–„çš„ TypeScript æ”¯æŒ
- ğŸ—ä¸ dva æ•°æ®æµçš„æ·±å…¥èåˆ
---
umi æœ‰ 2 å’Œ 3 ä¸¤ä¸ªç‰ˆæœ¬ã€‚ä¸¤ä¸ªç‰ˆæœ¬çš„ä½¿ç”¨éƒ½å·®ä¸å¤šã€‚umi2 å¯¹ javascript æ”¯æŒæ¯”è¾ƒå¥½ï¼Œumi3 é»˜è®¤æ”¯æŒ typeScript

## èµ·æ­¥Umi

### nodeç¯å¢ƒå®‰è£…

å»ºè®®å®‰è£…æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ï¼Œç¬”è€…è¿™é‡Œä¸º 14.15.3ã€‚åŒæ—¶å»ºè®®ä½¿ç”¨ yarn

### Umiå¿«é€Ÿä¸Šæ‰‹

åˆ›å»ºç©ºç›®å½• umi-learn

```bash
# æ–°å»ºåº”ç”¨
$ mkdir umi-learn && cd umi-learn

# ä½¿ç”¨å‘½ä»¤
$ yarn create umi

# å®‰è£…ä¾èµ–
$ yarn install
```

å®‰è£…è¿‡ç¨‹é€‰æ‹© app

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210126140249632.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNDc3NzIx,size_16,color_FFFFFF,t_70#pic_center)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/2021012614025699.png#pic_center)


### é¡¹ç›®å·¥ç¨‹ç»“æ„

```csharp
mock                    // mockæ–‡ä»¶
src
  |-- assets        	// é™æ€èµ„æºæ–‡ä»¶
  |-- layouts           // å…¨å±€å¸ƒå±€æ–‡ä»¶
  |-- pages           	// é¡¹ç›®é¡µé¢æ–‡ä»¶
  |-- globals           // å…¨å±€æ ·å¼
  |--.eslintignore     // eslintè¿‡æ»¤æ–‡ä»¶æ¸…å•
  |--.eslintrc.js      // eslinté…ç½®
  |--.eslintignore     // eslintè¿‡æ»¤æ–‡ä»¶æ¸…å•
  |--.eslintignore     // eslintè¿‡æ»¤æ–‡ä»¶æ¸…å•
  |--.umirc.js 		   // umi é…ç½®æ–‡ä»¶

```

### çº¦å®šå¼è·¯ç”±

> å¯åŠ¨ umi start åï¼Œå¤§å®¶ä¼šå‘ç° pages ä¸‹å¤šäº†ä¸ª .umi çš„ç›®å½•ã€‚ä¸è¦ç›´æ¥åœ¨è¿™é‡Œä¿®æ”¹ä»£ç ï¼Œumi é‡å¯æˆ–è€… pages ä¸‹çš„æ–‡ä»¶ä¿®æ”¹éƒ½ä¼šé‡æ–°ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œçº¦å®š pages ä¸‹æ‰€æœ‰çš„ (j|t)sx? æ–‡ä»¶å³è·¯ç”±

### åŠ¨æ€ç”Ÿæˆè·¯ç”±

```crystal
npx umi g page demo
```

> page ç›®å½•ä¸‹ç”Ÿæˆ demo.js å’Œ demo.cssã€‚.umirc.js ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸å¯¹åº”çš„è·¯ç”±ï¼Œè®¿é—® /demo è·¯ç”±ã€‚å³å¯çœ‹åˆ°é¡µé¢

```crystal
npx umi g page class/index
```

> page ç›®å½•ä¸‹ç”Ÿæˆ class æ–‡ä»¶å¤¹ / index.js å’Œ index.cssã€‚.umirc.js ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸å¯¹åº”çš„è·¯ç”±ï¼Œè®¿é—® /class/index è·¯ç”±ã€‚å³å¯çœ‹åˆ°é¡µé¢

> æ‰‹åŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œ.umirc.js æ–‡ä»¶ä¸­ä¸ä¼šç”Ÿæˆç›¸å¯¹åº”çš„è·¯ç”±

### è·å–è·¯ç”±ä¸­çš„å‚æ•°

è¯¥æ–‡ä»¶å¿…é¡»ä»¥ $ å¼€å¤´å‘½åï¼Œè¿™æ—¶ .umi æ–‡ä»¶å¤¹ä¸‹çš„ router.js æ–‡ä»¶ä¼šç”Ÿæˆå¯¹åº”çš„è·¯ç”±

### umi2 --> umi3

```bash
$ yarn create @umijs/umi-app
$ yarn install
```



### ä½¿ç”¨dva

åœ¨ umi é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ dva æ¥å¤„ç†æ•°æ®æµï¼Œä»¥å“åº”ä¸€äº›å¤æ‚çš„äº¤äº’æ“ä½œã€‚
 åœ¨ umi2 ä¸­è¦ä½¿ç”¨ dva çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œåªè¦ä½¿ç”¨ umi-plugin-react æ’ä»¶å¹¶é…ç½® dva:true å³å¯ã€‚
 ä¿®æ”¹é…ç½®çš„æ–‡ä»¶ï¼š./umirc.js

```js
// ref: https://umijs.org/config/
export default {
  plugins: [
    // ref: https://umijs.org/plugin/umi-plugin-react.html
    ['umi-plugin-react', {
      antd: true,
      dva: true, // åœ¨æ­¤å¤„å¯ç”¨ dva
      dynamicImport: false,
      title: 'hero',
      dll: false,
      routes: {
        exclude: [],
      },
      hardSource: false,
    }],
  ],
}
```

åœ¨dvaä¸­ï¼Œå¤„ç†æ•°æ®æµçš„æ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨ models æ–‡ä»¶å¤¹ä¸‹ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶é»˜è®¤å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«æ•°æ®å’Œå¤„ç†æ•°æ®çš„æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬ç§°ä¹‹ä¸º model ã€‚å¦‚ä»¥ä¸‹count.jsï¼Œmodelç»“æ„ä¸€èˆ¬æ˜¯å¦‚æ­¤ï¼š

##### ./src/models/count.js

```js
export default {
  namespace: 'count', // é»˜è®¤ä¸æ–‡ä»¶åç›¸åŒ
  state: 'count',
  subscriptions: {
    setup({ dispatch, history }) {
    },
  },
  // åŒæ­¥
  reducers: {
    update(state) {
      return `${state}_count`;
    },
  },
  // å¼‚æ­¥
  effects: {
    *fetch({ payload }, { call, put }) {
        yield put({
            type: 'update',
            payload
        })
    },
  },
}
```

### åœ¨é¡¹ç›®é¡µé¢ä¸­ä½¿ç”¨model

æˆ‘ä»¬éœ€è¦å¯¼å…¥connectå°†é¡µé¢å’Œmodelç»‘å®šåœ¨ä¸€èµ·ã€‚

```js
import { connect } from 'dva';  
function CountPage(props) {  
 //ä»propså±æ€§ä¸­æ‰“å°namespaceä¸ºcountçš„modelçš„stateæ•°æ®       
  console.log(props.count);      
  return (
    <div className={styles.normal}>
      <h1>æ•°é‡å¤§å°</h1>
      <h2>This is {props.count}</h2>
    </div>
  );
}
export default connect(({ count }) => ({ count }))(CountPage);  
```

å¦‚æœä½¿ç”¨es7çš„è£…é¥°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹æˆè¿™æ ·çš„å†™æ³•ï¼š

```js
import { connect } from 'dva'; 
// è£…é¥°å™¨ 
@connect(({ count }) => ({ count }))
function CountPage(props) {  
 // ä» props å±æ€§ä¸­æ‰“å° namespace ä¸º count çš„ model çš„ state æ•°æ®       
  console.log(props.count);      
  return (
    <div className={styles.normal}>
      <h1>æ•°é‡å¤§å°</h1>
      <h2>This is {props.count}</h2>
    </div>
  );
}
export default CountPage;
```

### mock æ–‡ä»¶å¤¹

> ä¸€èˆ¬çš„æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼Œumi çš„ mock æ˜¯å¯¹ express çš„å°è£…

```js
export default {
    'GET /api/getLists': {
        lists: ['a', 'b', 'c']
    },
    'GET /api/getListsAsync': (req, res) => {
        console.log(req)
        res.json({
            lists: Array(10).fill(req, query.value)
        })
    }
} 
```

### src / services æ–‡ä»¶å¤¹

> è¯·æ±‚æœ‰å…³çš„å¤„ç†æ–‡ä»¶

```js
export function getLists(value) {
    return fetch('/api/getLists?value=' + value)
        .then(res => res.json())
    	.catch(err => {
			console.log(err)
    	})
}
```

---
ä¸Šè¿°å†…å®¹å…¶å®åœ¨çœŸå®çš„é¡¹ç›®å¼€å‘å½“ä¸­æ‰€ç”¨ä¸å¤šï¼Œä½¿ç”¨ umi æ¡†æ¶å¼€å‘é¡¹ç›®çš„æ–¹å¼ï¼Œä¸ react å‡ ä¹æ— å¼‚ã€‚æ—¢ç„¶å¦‚ä½•é‚£ä¸ºä½•è¦å­¦ï¼Ÿè¯†ä¸‡å·ä¹¦ï¼Œè¡Œä¸‡é‡Œè·¯ã€‚è§å¾—ä¸œè¥¿è¶Šå¤šï¼Œè¶Šèƒ½æ˜ç™½è‡ªå·±çš„ä¸è¶³ä¹‹å¤„ã€‚ï¼ˆé¡¹ç›®å®æˆ˜ï¼šé©¿æ—…é˜³å…‰ï¼›giteeåœ°å€ï¼šhttps://gitee.com/suiboyu/post-travel-sunshineï¼‰

ä¸‹é¢æ˜¯ç¬”è€…å¼€å‘é¡¹ç›®æ¶æ„ï¼Œå„ä½å¯ä»¥åšä¸ªå‚è€ƒ

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210220173329203.png#pic_center)

æºä»£ç å­˜æ”¾åœ¨ gitee ä¸­

å…³æ³¨å…¬ä¼—å·ï¼šå¤§æ˜è´µå¦‡ï¼Œè·å– Umi.js å­¦ä¹ èµ„æ–™ï¼ˆå›å¤ Umi ï¼‰ï¼ŒæœŸå¾…å„ä½å®¢å®˜æ¥ä¸´

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210126140631293.jpg#pic_center)

å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/dc493809a2fd
